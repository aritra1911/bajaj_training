
postgres=# create database bajaj;
CREATE DATABASE
postgres=# \c bajaj
You are now connected to database "bajaj" as user "postgres".

bajaj=# create table color (
bajaj(#     color_id int generated always as identity,
bajaj(#     color_name varchar not null
bajaj(# );
CREATE TABLE
bajaj=# 

bajaj=# insert into color values (2, 'Pink');
ERROR:  cannot insert a non-DEFAULT value into column "color_id"
DETAIL:  Column "color_id" is an identity column defined as GENERATED ALWAYS.
HINT:  Use OVERRIDING SYSTEM VALUE to override.

bajaj=# insert into color (color_id, color_name)
bajaj-# overriding system value
bajaj-# values (2, 'Pink');
INSERT 0 1
bajaj=# 

bajaj=# select * from color;
        2 | Pink

bajaj=# insert into color (color_id, color_name)
bajaj-# overriding system value
bajaj-# values (5, 'Blue');
INSERT 0 1
bajaj=# select * from color;
        2 | Pink
        5 | Blue

bajaj=# drop table color;
DROP TABLE
bajaj=# create table color (
bajaj(#     color_id int generated by default as identity (start with 5 increment by 10),
bajaj(#     color_name varchar not null
bajaj(# );
CREATE TABLE
bajaj=# 

bajaj=# insert into color (color_name) values ('Pink');
INSERT 0 1
bajaj=# insert into color (color_name) values ('Blue');
INSERT 0 1
bajaj=# insert into color (color_name) values ('Green'), ('Red');
INSERT 0 2
bajaj=# select * from color;
        5 | Pink
       15 | Blue
       25 | Green
       35 | Red

bajaj=# create table dept (
bajaj(#     dept_id int,
bajaj(#     dept_name varchar(20),
bajaj(#     primary key (dept_id)
bajaj(# );
CREATE TABLE
bajaj=# 
bajaj=# \d dept
                        Table "public.dept"
  Column   |         Type          | Collation | Nullable | Default 
-----------+-----------------------+-----------+----------+---------
 dept_id   | integer               |           | not null | 
 dept_name | character varying(20) |           |          | 
Indexes:
    "dept_pkey" PRIMARY KEY, btree (dept_id)
Referenced by:
    TABLE "emp" CONSTRAINT "fk_dept" FOREIGN KEY (dept_id) REFERENCES dept(dept_id)

bajaj=# create table emp (
bajaj(#     eid varchar(5), 
bajaj(#     name varchar(20),
bajaj(#     sal int,
bajaj(#     dept_id int,
bajaj(#     primary key (eid),
bajaj(#     constraint fk_dept foreign key (dept_id) references dept (dept_id)
bajaj(# );
CREATE TABLE
bajaj=# \d emp
                        Table "public.emp"
 Column  |         Type          | Collation | Nullable | Default 
---------+-----------------------+-----------+----------+---------
 eid     | character varying(5)  |           | not null | 
 name    | character varying(20) |           |          | 
 sal     | integer               |           |          | 
 dept_id | integer               |           |          | 
Indexes:
    "emp_pkey" PRIMARY KEY, btree (eid)
Foreign-key constraints:
    "fk_dept" FOREIGN KEY (dept_id) REFERENCES dept(dept_id)

bajaj=# insert into emp values ('E01', 'Ram', 15000);
INSERT 0 1
bajaj=# 
bajaj=# select * from emp;
 E01 | Ram  | 15000 |        

bajaj=# insert into emp values ('E02', 'Mary', 20000, 3);
ERROR:  insert or update on table "emp" violates foreign key constraint "fk_dept"
DETAIL:  Key (dept_id)=(3) is not present in table "dept".
bajaj=# 

bajaj=# insert into dept values (1, 'Java'), (4, 'Python'), (5, 'PHP'), (23, 'Angular');
INSERT 0 4
bajaj=# select * from dept;
 dept_id | dept_name 
---------+-----------
       1 | Java
       4 | Python
       5 | PHP
      23 | Angular
(4 rows)

bajaj=# update emp set dept_id = 5;
UPDATE 1
bajaj=# select * from emp;
 eid | name |  sal  | dept_id 
-----+------+-------+---------
 E01 | Ram  | 15000 |       5
(1 row)

bajaj=# delete from dept where dept_id = 5;
ERROR:  update or delete on table "dept" violates foreign key constraint "fk_dept" on table "emp"
DETAIL:  Key (dept_id)=(5) is still referenced from table "emp".
bajaj=# 
bajaj=# delete from dept where dept_id = 23;
DELETE 1
bajaj=# select * from dept;
 dept_id | dept_name 
---------+-----------
       1 | Java
       4 | Python
       5 | PHP
(3 rows)

bajaj=# insert into emp values ('E01', 'Ram', 15000, 56);
ERROR:  insert or update on table "emp" violates foreign key constraint "fk_dept"
DETAIL:  Key (dept_id)=(56) is not present in table "dept".

bajaj=# drop table if exists emp;
DROP TABLE
bajaj=# create table emp (
bajaj(#     eid varchar(5),
bajaj(#     name varchar(20),
bajaj(#     sal int,
bajaj(#     dept_id int,
bajaj(#     primary key (eid),
bajaj(#     constraint fk_dept foreign key (dept_id)
bajaj(#         references dept (dept_id)
bajaj(#         on delete cascade
bajaj(# );
CREATE TABLE
bajaj=# 
bajaj=# insert into emp values ('E01', 'Ram', 15000, 5);
INSERT 0 1
bajaj=# select * from emp;
 eid | name |  sal  | dept_id 
-----+------+-------+---------
 E01 | Ram  | 15000 |       5
(1 row)

bajaj=# delete from dept where dept_id = 5;
DELETE 1
bajaj=# select * from emp;
 eid | name | sal | dept_id 
-----+------+-----+---------
(0 rows)

bajaj=# insert into emp values ('101', 'Ram', 15000, 1);
INSERT 0 1
bajaj=# insert into emp values ('102', 'Rohit', 20000, 4);
INSERT 0 1
bajaj=# insert into emp values ('103', 'Amit', 12000, 1);
INSERT 0 1
bajaj=# insert into emp values ('104', 'Rahul', 50000, 4);
INSERT 0 1
bajaj=# insert into emp values ('105', 'Abhay', 30000, 4);
INSERT 0 1

bajaj=# select * from emp where eid = '102';
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 102 | Rohit | 20000 |       4
(1 row)

bajaj=# select * from emp where name = 'Rohit' AND sal >= 14000;
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 102 | Rohit | 20000 |       4
(1 row)

bajaj=# select * from emp where name = 'Amit' or name = 'Rahul';;
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 103 | Amit  | 12000 |       1
 104 | Rahul | 50000 |       4
(2 rows)

bajaj=# select * from emp where name in ('Rohit', 'Ram', 'Abhay');
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 102 | Rohit | 20000 |       4
 105 | Abhay | 30000 |       4
 101 | Ram   | 15000 |       1
(3 rows)

bajaj=# select * from emp where name like 'Ab%';
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 105 | Abhay | 30000 |       4
(1 row)

bajaj=# select * from emp where name ~* '^R.*t.*';
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 102 | Rohit | 20000 |       4
(1 row)

bajaj=# select * from emp where sal between 10000 and 50000;
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 102 | Rohit | 20000 |       4
 103 | Amit  | 12000 |       1
 104 | Rahul | 50000 |       4
 105 | Abhay | 30000 |       4
 101 | Ram   | 15000 |       1
(5 rows)

bajaj=# select * from emp where length(name) <> 5;
 eid | name |  sal  | dept_id 
-----+------+-------+---------
 103 | Amit | 12000 |       1
 101 | Ram  | 15000 |       1
(2 rows)

bajaj=# select * from emp where eid = '102';
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 102 | Rohit | 20000 |       4
(1 row)

bajaj=# select * from emp;
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 102 | Rohit | 20000 |       4
 103 | Amit  | 12000 |       1
 104 | Rahul | 50000 |       4
 105 | Abhay | 30000 |       4
 101 | Ram   | 15000 |       1
(5 rows)

bajaj=# delete from emp where eid = '102';
DELETE 1
bajaj=# select * from emp;
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 103 | Amit  | 12000 |       1
 104 | Rahul | 50000 |       4
 105 | Abhay | 30000 |       4
 101 | Ram   | 15000 |       1
(4 rows)

bajaj=# select concat (name, sal) from emp;
   concat   
------------
 Amit12000
 Rahul50000
 Abhay30000
 Ram15000
(4 rows)

bajaj=# select round (1372.472, 1);
 round  
--------
 1372.5
(1 row)

bajaj=# select count (sal) from emp;
 count 
-------
     4
(1 row)

bajaj=# select name, sum (sal) from emp where name = 'Rahul' group by name;
 name  |  sum  
-------+-------
 Rahul | 50000
(1 row)

bajaj=# select name, sum (sal) from emp group by name order by sum (sal) desc;
 name  |  sum  
-------+-------
 Rahul | 50000
 Abhay | 30000
 Ram   | 15000
 Amit  | 12000
(4 rows)

bajaj=# select eid, name, sal, dept_name
bajaj-# from emp inner join dept on 
bajaj-# emp.dept_id = dept.dept_id;
 eid | name  |  sal  | dept_name 
-----+-------+-------+-----------
 103 | Amit  | 12000 | Java
 104 | Rahul | 50000 | Python
 105 | Abhay | 30000 | Python
 101 | Ram   | 15000 | Java
(4 rows)

  S E L F - J O I N
 -------------------

bajaj=# create table employee (
bajaj(#     eid int primary key,
bajaj(#     fname varchar(20),
bajaj(#     lname varchar(20),
bajaj(#     manager_id int,
bajaj(#     foreign key (manager_id)
bajaj(#         references employee (eid)
bajaj(#         on delete cascade
bajaj(# );
CREATE TABLE
bajaj=# insert into employee values
bajaj-# (1, 'Ram', 'Patel', NULL),
bajaj-# (2, 'Ana', 'Connor', 1),
bajaj-# (3, 'Hasan', 'Reevas', 1),
bajaj-# (4, 'Tom', 'Lester', 2),
bajaj-# (5, 'Kelly', 'Christen', 2),
bajaj-# (6, 'Kelsie', 'Hales', 3),
bajaj-# (7, 'Sam', 'Norman', 3),
bajaj-# (8, 'Windy', 'Hays', 3);
INSERT 0 8
bajaj=# select e.fname || ' ' || e.lname employee,
bajaj-#        m.fname || ' ' || m.lname manager
bajaj-# from employee e inner join employee m on
bajaj-# m.eid = e.manager_id order by manager;
    employee    |   manager    
----------------+--------------
 Kelly Christen | Ana Connor
 Tom Lester     | Ana Connor
 Windy Hays     | Hasan Reevas
 Kelsie Hales   | Hasan Reevas
 Sam Norman     | Hasan Reevas
 Ana Connor     | Ram Patel
 Hasan Reevas   | Ram Patel
(7 rows)

  S U B Q U E R Y   ( N E S T E D   Q U E R Y )
 -----------------------------------------------

bajaj=# select name, sal 
bajaj-# from emp where sal > (
bajaj(#     select sal from emp
bajaj(#     where name = 'Amit'
bajaj(# );
 name  |  sal  
-------+-------
 Rahul | 50000
 Abhay | 30000
 Ram   | 15000
(3 rows)

bajaj=# select * from emp
bajaj-# where sal > (
bajaj(#     select avg (sal)
bajaj(#     from emp
bajaj(# );
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 104 | Rahul | 50000 |       4
 105 | Abhay | 30000 |       4
(2 rows)


bajaj=# BEGIN;  -- OR BEGIN WORK;  OR BEGIN TRANSACTION;
BEGIN
bajaj=*# UPDATE emp set sal = 45000
bajaj-*# WHERE eid = '102';
UPDATE 0
bajaj=*# COMMIT;

         ROLLBACK; OR ROLLBACK WORK;
                   OR ROLLBACK TRANSACTION;

bajaj=# create index emp_index 
bajaj-# on emp (eid);
CREATE INDEX
bajaj=# 
bajaj=# create unique index
bajaj-# on emp (eid);
CREATE INDEX
bajaj=# 
bajaj=# drop index emp_index;
DROP INDEX
bajaj=# 

bajaj=# insert into emp values ('102', 'Ram', 15000);
INSERT 0 1
bajaj=# 
bajaj=# select * from emp ORDER BY dept_id NULLS FIRST;
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 102 | Ram   | 15000 |        
 103 | Amit  | 12000 |       1
 101 | Ram   | 15000 |       1
 104 | Rahul | 50000 |       4
 105 | Abhay | 30000 |       4
(5 rows)

bajaj=# select * from emp ORDER BY dept_id NULLS LAST;
 eid | name  |  sal  | dept_id 
-----+-------+-------+---------
 103 | Amit  | 12000 |       1
 101 | Ram   | 15000 |       1
 104 | Rahul | 50000 |       4
 105 | Abhay | 30000 |       4
 102 | Ram   | 15000 |        
(5 rows)


    A S S I G N M E N T
   ---------------------

    1. Student
        - roll_no pk
        - name
        - address
        - contact_no
        - age

    2. Insert 10 rows

    3. Print name, address order by roll_no (alias code)

    4. Student Details
        - roll_no
        - branch
        - grade

    5. Print grade, name of student with age == 20

    6. Print records from Student with address containing letters 'a' or
       'b' or 'c'.  ( Hint : Use '%[a-c]%' in LIKE statement.
                             '%[^a-c]%' complements the previous.)


bajaj=# create table student (
bajaj(#     roll_no int primary key,
bajaj(#     name varchar(32),
bajaj(#     address varchar(256),
bajaj(#     contact_no varchar(16),
bajaj(#     age int
bajaj(# );
CREATE TABLE
bajaj=# create table student_details (
bajaj(#     roll_no int,
bajaj(#     branch varchar(32),
bajaj(#     grade char(1),
bajaj(#     foreign key (roll_no)
bajaj(#         references student (roll_no)
bajaj(#         on delete cascade
bajaj(# );
CREATE TABLE
bajaj=# insert into student values 
bajaj-# (1, 'Prakash', 'Gorakhpur', 989796, 22),
bajaj-# (2, 'Sparsh', 'Bareily', 87876, 19),
bajaj-# (3, 'Archisman', 'Kolkata', 1234, 21),
bajaj-# (4, 'Jishnu', 'Delhi', 1234, 20),
bajaj-# (5, 'Prakul', 'Lucknow', 4567, 23),
bajaj-# (6, 'Aritra', 'Kolkata', 9038138876, 22),
bajaj-# (7, 'Dayeem', 'Mumbai', 426378, 20),
bajaj-# (8, 'Shivam', 'Delhi', 287639283, 20),
bajaj-# (9, 'Aditya', 'Nellore', 82372372094, 21),
bajaj-# (10, 'Aryaman', 'Pune', 8236429386492, 20);
INSERT 0 10
bajaj=# insert into student_details values 
bajaj-# (1, 'CSE', 'A'),
bajaj-# (2, 'CSE', 'B'),
bajaj-# (3, 'CSE', 'A'),
bajaj-# (4, 'ECE', 'B'),
bajaj-# (5, 'CSE', 'F'),
bajaj-# (6, 'ECS', 'D'),
bajaj-# (7, 'CSE', 'A'),
bajaj-# (8, 'CSE', 'B'),
bajaj-# (9, 'ECE', 'A'),
bajaj-# (10, 'CSE', 'A');
INSERT 0 10
bajaj=# select roll_no as code, name, address from student order by code;
 code |   name    |  address  
------+-----------+-----------
    1 | Prakash   | Gorakhpur
    2 | Sparsh    | Bareily
    3 | Archisman | Kolkata
    4 | Jishnu    | Delhi
    5 | Prakul    | Lucknow
    6 | Aritra    | Kolkata
    7 | Dayeem    | Mumbai
    8 | Shivam    | Delhi
    9 | Aditya    | Nellore
   10 | Aryaman   | Pune
(10 rows)

bajaj=# select grade, name from student s
bajaj-# left join student_details sd 
bajaj-# on s.roll_no = sd.roll_no
bajaj-# where age = 20;
 grade |  name   
-------+---------
 B     | Jishnu
 A     | Dayeem
 B     | Shivam
 A     | Aryaman
(4 rows)

bajaj=# select * from student where address ~* '.*[a-c].*';
 roll_no |   name    |  address  | contact_no | age 
---------+-----------+-----------+------------+-----
       1 | Prakash   | Gorakhpur | 989796     |  22
       2 | Sparsh    | Bareily   | 87876      |  19
       3 | Archisman | Kolkata   | 1234       |  21
       5 | Prakul    | Lucknow   | 4567       |  23
       6 | Aritra    | Kolkata   | 9038138876 |  22
       7 | Dayeem    | Mumbai    | 426378     |  20
(6 rows)


